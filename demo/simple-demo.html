<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Contextual Notification -- Simple Demo</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../polymer/polymer.html"/>
  <link rel="import" href="../../px-theme/px-theme-styles.html">
  <link rel="import" href="../px-contextual-notification.html"/>
  <link rel="import" href="../../px-icon-set/px-icon-set.html"/>
  <link rel="import" href="../../px-chip/px-chip.html"/>

  <style>
    .chips {
      display: flex;
    }
    px-chip {
      padding-right: 10px;
      padding-top: 2px;
      padding-bottom: 2px;
    }
  </style>
  <custom-style>
    <style is="custom-style">
      .auto-size-notification {
        --px-contextual-notification-height: auto;
      }
      .whiteChip {
        --px-chip-border-color: white;
        --px-chip-border-color--hover: white;
        --px-chip-text-color: white;
        --px-chip-icon-color: white;
        --px-chip-icon-color--hover: white;
        --px-chip-background-color--hover: rgba(255,255,255,0.2);
      }
      .blackChip {
        --px-chip-border-color: black;
        --px-chip-border-color--hover: black;
        --px-chip-text-color: black;
        --px-chip-icon-color: black;
        --px-chip-icon-color--hover: black;
        --px-chip-background-color--hover: rgba(0,0,0,0.2);
      }
    </style>
  </custom-style>

</head>

<body>
  <custom-style>
    <style include="px-theme-styles" is="custom-style"></style>
  </custom-style>

  <h2>There should only ever be one contextual notification within a given context (e.g. in an app, context browser panel, etc.)</h2>
  <px-contextual-notification
    id="contextualNotification"
    type="info"
    status-icon="px-utl:filter"
    content="26 Filters 2,479,322 Devices"
    opened>
  </px-contextual-notification>
  <br>
  <button class="btn" onclick="_handleUpdateNotification()">
    Update notification
  </button>

</body>
</html>

<script>
  let contextualNotification = document.querySelector('#contextualNotification');
  contextualNotification.addEventListener('px-contextual-notification-action-tapped', _handleContextualNotificationTapped);

  const undoBtn = document.createElement('button');
  undoBtn.setAttribute('slot', 'right');
  undoBtn.innerHTML = ('Undo');

  const clearAllbtn = document.createElement('button');
  clearAllbtn.setAttribute('slot', 'right');
  clearAllbtn.innerHTML = ('Clear All');

  const filterChips = document.createElement('div');
  filterChips.setAttribute('slot', 'content');
  const chip1 = document.createElement('px-chip');
  const chip2 = document.createElement('px-chip');
  const chip3 = document.createElement('px-chip');
  chip1.setAttribute('content', 'name');
  chip2.setAttribute('content', 'location');
  chip3.setAttribute('content', 'date');
  const chips = [chip1, chip2, chip3];
  chips.forEach(chip => {
    chip.setAttribute('class', 'blackChip');
    chip.setAttribute('show-icon', true);
    chip.setAttribute('not-selectable', true);
  });
  filterChips.append(chip1, chip2, chip3);

  // Note: this array is just for demo purposes. In your app you should be
  // generating your contextual notifications based on dynamic data and events.
  const notificationsArray = [
    {
      type: 'info',
      status: 'px-utl:filter',
      content: '26 Filters 2,479,322 Devices',
      action: '',
      opened: true,
      right: undoBtn
    },
    {
      type: 'healthy',
      status: 'px-utl:confirmed',
      content: 'Your dashboard has been successfully created.',
      action: 'px-nav:close',
      opened: true
    },
    {
      type: 'important',
      status: 'px-utl:delete',
      content: 'Widget has been removed from your dashboard.',
      action: 'px-com:chat',
      opened: true
    },
    {
      type: 'healthy',
      status: 'px-utl:confirmed',
      content: 'Your dashboard has been successfully created.',
      action: 'px-nav:close',
      opened: true
    },
    {
      type: 'error',
      status: '',
      content: '',
      action: '',
      opened: true,
      content: filterChips,
      right: clearAllbtn
    },
    {
      type: 'info',
      status: '',
      content: '26 Filters',
      action: '',
      opened: true,
      small: true
    }

  ]

  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
  }

  function _handleUpdateNotification() {
    // remove any leftover slot content from previous notifications
    while (contextualNotification.firstChild) {
      contextualNotification.removeChild(contextualNotification.firstChild);
    }
    let randomIndex = getRandomInt(0, notificationsArray.length);
    contextualNotification.setAttribute('type', notificationsArray[randomIndex].type);
    contextualNotification.setAttribute('status-icon', notificationsArray[randomIndex].status);
    contextualNotification.setAttribute('content', notificationsArray[randomIndex].content);
    contextualNotification.setAttribute('action-icon', notificationsArray[randomIndex].action);
    if (notificationsArray[randomIndex].small) {
      contextualNotification.setAttribute('small', true);
    } else {
      contextualNotification.removeAttribute('small');
    }
    if (notificationsArray[randomIndex].opened) {
      contextualNotification.setAttribute('opened', true);
    } else {
      contextualNotification.removeAttribute('opened');
    }
    // update slots if they have content
    if (notificationsArray[randomIndex].left) {
      contextualNotification.appendChild(notificationsArray[randomIndex].left);
    }
    if (notificationsArray[randomIndex].content) {
      contextualNotification.appendChild(notificationsArray[randomIndex].content);
    }
    if (notificationsArray[randomIndex].right) {
      contextualNotification.appendChild(notificationsArray[randomIndex].right);
    }
  }

  function _handleContextualNotificationTapped(e) {
    let iconButtonAction;
    if (e.detail.rootTarget.classList.contains('btn--icon')) {
      iconButtonAction = e.detail.rootTarget.querySelector('px-icon').getAttribute('icon');
    }
    else if (e.detail.rootTarget.nodeName === 'BUTTON') {
      iconButtonAction = (e.detail.rootTarget.firstChild.data);
    }
    console.log(iconButtonAction); // handle tap events accordingly based on action
  };

</script>
